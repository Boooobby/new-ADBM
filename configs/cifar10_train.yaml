# -------------------------------------------------------------------------
# ADBM Configuration for CIFAR-10
# Based on: ft_fz_wcls_cifar10_sde.yaml + vp_sde_cifar10.yaml
# -------------------------------------------------------------------------

# [实验元数据]
dataset: "CIFAR10"
output_dir: "./outputs/cifar10_adbm_training"

# [新增：数据参数] <--- 必须补上这块，不然报错
data:
  image_size: 32
  channels: 3
  num_channels: 3
  centered: True
  random_flip: True

# [模型权重路径]
model:
  init_ckpt: "./weights/32x32_ckpt_8_diffusion.pth"
  classifier_ckpt: "./weights/WideResNet_70_16_dropout_cifar10.pth"

  # ==========================================
  # [新增] 下面这三行必须补上，否则代码不知道模型长啥样
  # ==========================================
  depth: 70           # 深度
  widen_factor: 16    # 宽度
  dropRate: 0.3       # Dropout
  # ==========================================
  
  # --- Score-SDE 核心参数 ---
  name: 'ncsnpp'
  sigma_min: 0.01
  sigma_max: 50
  num_scales: 1000
  beta_min: 0.1
  beta_max: 20.
  dropout: 0.1
  scale_by_sigma: False
  ema_rate: 0.999
  normalization: 'GroupNorm'
  nonlinearity: 'swish'
  nf: 128
  ch_mult: [1, 2, 2, 2]
  num_res_blocks: 8
  attn_resolutions: [16]
  resamp_with_conv: True
  conditional: True
  fir: False
  fir_kernel: [1, 3, 3, 1]
  skip_rescale: True
  resblock_type: 'biggan'
  progressive: 'none'
  progressive_input: 'none'
  progressive_combine: 'sum'
  attention_type: 'ddpm'
  init_scale: 0.
  embedding_type: 'positional'
  fourier_scale: 16
  conv_size: 3

# [训练参数]
training:
  batch_size: 64
  total_iterations: 30010
  log_freq: 100
  snapshot_freq: 5000
  advtrain: True
  tune_T_min: 0.1
  tune_T_max: 0.2
  beta_d: 19.9
  beta_min: 0.1

# [优化器参数]
optim:
  optimizer: 'Adam'
  lr: 2.0e-4
  beta1: 0.9
  eps: 1.0e-8
  warmup: 5000
  grad_clip: 1.0
  weight_decay: 0.0

# [攻击参数]
attack:
  eps: 8
  steps: 3
  step_size: 8

# [评估/测试参数]
eval:
  batch_size: 64
  purify_step: 0.2
  reverse_steps: 2
